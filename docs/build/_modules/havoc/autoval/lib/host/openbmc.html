

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>havoc.autoval.lib.host.openbmc &mdash; UHDDT PyDoc 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html">
          

          
            
            <img src="../../../../../_static/fbicon.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">havoc</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">UHDDT PyDoc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
        
      <li>havoc.autoval.lib.host.openbmc</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for havoc.autoval.lib.host.openbmc</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">havoc.autoval.lib.test_utils.utils</span> <span class="k">as</span> <span class="nn">utils</span>

<span class="kn">from</span> <span class="nn">havoc.autotest_testfiles.validation_utils.lib.autoval_exceptions</span> <span class="k">import</span> <span class="n">TestError</span>
<span class="kn">from</span> <span class="nn">havoc.autotest_testfiles.validation_utils.lib.autoval</span> <span class="k">import</span> <span class="n">AutovalUtils</span>
<span class="kn">from</span> <span class="nn">havoc.autotest_testfiles.validation_utils.lib.site_utils</span> <span class="k">import</span> <span class="n">SiteUtils</span>
<span class="kn">from</span> <span class="nn">havoc.autotest_testfiles.validation_utils.result_handler</span> <span class="k">import</span> <span class="n">ResultHandler</span>

<span class="kn">from</span> <span class="nn">havoc.lib.decorators</span> <span class="k">import</span> <span class="n">retry</span>
<span class="kn">from</span> <span class="nn">havoc.autoval.lib.host.ipmi</span> <span class="k">import</span> <span class="n">IPMI</span>


<div class="viewcode-block" id="OpenBMC"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC">[docs]</a><span class="k">class</span> <span class="nc">OpenBMC</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">result_handler</span> <span class="o">=</span> <span class="n">ResultHandler</span><span class="p">()</span>
    <span class="n">SEL_TIME_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span>

<div class="viewcode-block" id="OpenBMC.__init__"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">bmc_host</span><span class="p">,</span> <span class="n">oob_addr</span><span class="p">,</span> <span class="n">slot_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="k">if</span> <span class="n">oob_addr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">connection_obj</span><span class="o">.</span><span class="n">bmc_connection</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This means we run inband</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span> <span class="o">=</span> <span class="n">bmc_host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oob_addr</span> <span class="o">=</span> <span class="n">oob_addr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ipmi</span> <span class="o">=</span> <span class="n">IPMI</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">bmc_host</span><span class="p">,</span> <span class="n">oob_addr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_filter</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_slot_info</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="OpenBMC.collect_debug_logs"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.collect_debug_logs">[docs]</a>    <span class="k">def</span> <span class="nf">collect_debug_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">):</span>
        <span class="n">sol_history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sol_history</span><span class="p">()</span>
        <span class="n">dump_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s2">&quot;sol_history.log&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dump_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">target_file</span><span class="p">:</span>
            <span class="n">target_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sol_history</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Collected SOL history: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dump_file</span><span class="p">))</span></div>

<div class="viewcode-block" id="OpenBMC.get_sol_history"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_sol_history">[docs]</a>    <span class="k">def</span> <span class="nf">get_sol_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_slot_info</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;sol-util </span><span class="si">%s</span><span class="s2"> --history&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_slot_info</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.get_fru_no"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_fru_no">[docs]</a>    <span class="k">def</span> <span class="nf">get_fru_no</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This should be overwritten in</span>
        <span class="c1"># OpenBMC subclasses</span>
        <span class="k">return</span> <span class="s1">&#39;mb&#39;</span></div>

<div class="viewcode-block" id="OpenBMC.get_slot_info"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_slot_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_slot_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This should be overwritten in</span>
        <span class="c1"># OpenBMC subclasses</span>
        <span class="k">return</span> <span class="s1">&#39;mb&#39;</span></div>

<div class="viewcode-block" id="OpenBMC.add_sel_message"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.add_sel_message">[docs]</a>    <span class="k">def</span> <span class="nf">add_sel_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">start</span><span class="p">):</span>
        <span class="n">slot_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fru_no</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;logger -p user.crit </span><span class="se">\&quot;</span><span class="s2">Start Havoc </span><span class="si">%s</span><span class="s2"> on FRU: </span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">test_name</span><span class="p">,</span> <span class="n">slot_no</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;logger -p user.crit </span><span class="se">\&quot;</span><span class="s2">End Havoc </span><span class="si">%s</span><span class="s2"> on FRU: </span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">test_name</span><span class="p">,</span> <span class="n">slot_no</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

    <span class="c1"># Health Check to identify is the device is OpenBMC capable or not</span>
<div class="viewcode-block" id="OpenBMC.is_opembmc"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.is_opembmc">[docs]</a>    <span class="k">def</span> <span class="nf">is_opembmc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">is_openbmc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_openbmc</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="OpenBMC.is_legacybmc"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.is_legacybmc">[docs]</a>    <span class="k">def</span> <span class="nf">is_legacybmc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ipmi</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpenBMC.get_fruid_info"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_fruid_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_fruid_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/fruid-util all&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">ignore_status</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.check_critical_errors"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.check_critical_errors">[docs]</a>    <span class="k">def</span> <span class="nf">check_critical_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="OpenBMC.get_bios_reset_options"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_bios_reset_options">[docs]</a>    <span class="k">def</span> <span class="nf">get_bios_reset_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;bios_util&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_boot_order_cmos</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="OpenBMC.get_fw_versions"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_fw_versions">[docs]</a>    <span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">sleep_seconds</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">exponential</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_fw_versions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fw-util all --version&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_fw_data</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.parse_fw_data"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.parse_fw_data">[docs]</a>    <span class="k">def</span> <span class="nf">parse_fw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="n">fw_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">virtual_rail_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(.*)\s+[Vv]ersion\:\s+(.*)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="n">m_cpld</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;CPLD\s+[vV]ersion:\s+(\w+),\s+CPLD\s+[Dd]evice[Ii][Dd]:\s+(\w+)&quot;</span><span class="p">,</span> <span class="n">line</span>
            <span class="p">)</span>
            <span class="n">m_vr1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(.*\s)VR\s+Version:\s+(\w+),\s+(\w+)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="n">m_vr2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;(^VR.*)\s+[Vv]ersion:\s+(\w+),\s+[Cc]hecksum:\s+(\w+),\s+[Dd]evice[Ii][Dd]:\s+(\w+)&quot;</span><span class="p">,</span>
                <span class="n">line</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">m_vr2</span><span class="p">:</span>
                <span class="n">virtual_rail_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;vr_name&quot;</span><span class="p">:</span> <span class="n">m_vr2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">m_vr2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                        <span class="s2">&quot;checksum&quot;</span><span class="p">:</span> <span class="n">m_vr2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                        <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">m_vr2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">m_vr1</span><span class="p">:</span>
                <span class="n">virtual_rail_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">m_vr1</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                        <span class="s2">&quot;vr_name&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_vr&quot;</span> <span class="o">%</span> <span class="n">m_vr1</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                        <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">m_vr1</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">m_cpld</span><span class="p">:</span>
                <span class="n">fw_data</span><span class="p">[</span><span class="s2">&quot;cpld_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_cpld</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">fw_data</span><span class="p">[</span><span class="s2">&quot;cpld_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_cpld</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">fw_data</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_version&quot;</span> <span class="o">%</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span>
                    <span class="mi">2</span>
                <span class="p">)</span>
        <span class="n">fw_data</span><span class="p">[</span><span class="s2">&quot;virtual_rail_json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">virtual_rail_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fw_data</span></div>

<div class="viewcode-block" id="OpenBMC.get_config"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_config">[docs]</a>    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">log_dir</span><span class="p">,</span>
        <span class="n">test_start_time</span><span class="p">,</span>
        <span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bios_dump_filter</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves all configuration data about this OpenBMC system and returns</span>
<span class="sd">        it in a dictionary.</span>

<span class="sd">        @param log_dir: Will store logfile contents in this directory</span>
<span class="sd">        @param Float test_start_time: epoch time when test begins</span>
<span class="sd">        @param start: Indicates whether this is the start or the end of the test</span>
<span class="sd">        @param cfg_filter: object that contains config check filters</span>
<span class="sd">        @return {}: dictionary with config check info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collect_sensor_history</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="n">test_start_time</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config_details</span><span class="p">(</span>
            <span class="n">log_dir</span><span class="p">,</span>
            <span class="n">test_start_time</span><span class="p">,</span>
            <span class="n">start</span><span class="p">,</span>
            <span class="n">bios_dump_filter</span><span class="o">=</span><span class="n">bios_dump_filter</span>
        <span class="p">)</span>
        <span class="n">config_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_filter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_config_filter</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config_dict</span></div>

<div class="viewcode-block" id="OpenBMC.get_config_details"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_config_details">[docs]</a>    <span class="k">def</span> <span class="nf">get_config_details</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">log_dir</span><span class="p">,</span>
        <span class="n">test_start_time</span><span class="p">,</span>
        <span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bios_dump_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">config_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_as_cmd</span><span class="p">(</span><span class="s2">&quot;+++Start of Havoc SystemInfo collection&quot;</span><span class="p">)</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;+++Getting log util info&quot;</span><span class="p">)</span>
        <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;log_util&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_log_util_errors</span><span class="p">(</span><span class="n">test_start_time</span><span class="p">)</span>

        <span class="c1"># For sensor log before vs. after test comparison</span>
        <span class="c1"># Only concern if a sensor goes bad after the test</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;+++Getting sensor data&quot;</span><span class="p">)</span>
        <span class="n">sensors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_sensor_data</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">filtered_sensors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_sensor_log</span><span class="p">(</span><span class="n">sensors</span><span class="p">)</span>
        <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;sensors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filtered_sensors</span><span class="p">)</span>

        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;+++Getting fruid info&quot;</span><span class="p">)</span>
        <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;product_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_fruid_list</span><span class="p">()</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;+++Getting All FRU FW version data&quot;</span><span class="p">)</span>
        <span class="n">bmc_fw_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fw_versions</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fru_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;rom&quot;</span><span class="p">,</span> <span class="s2">&quot;bmc&quot;</span><span class="p">,</span> <span class="s2">&quot;cpld&quot;</span><span class="p">,</span> <span class="s2">&quot;tpm&quot;</span><span class="p">,</span> <span class="s2">&quot;bridge-ic&quot;</span><span class="p">,</span> <span class="s2">&quot;bios&quot;</span><span class="p">,</span> <span class="s2">&quot;me&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">fru_name</span> <span class="ow">in</span> <span class="n">bmc_fw_data</span><span class="p">:</span>
                <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span>
                    <span class="s2">&quot;System is running with </span><span class="si">%s</span><span class="s2"> version: </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">fru_name</span><span class="p">,</span> <span class="n">bmc_fw_data</span><span class="p">[</span><span class="n">fru_name</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_version&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fru_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">bmc_fw_data</span><span class="p">:</span>
                <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span>
                    <span class="s2">&quot;System is running with </span><span class="si">%s</span><span class="s2"> version: </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">fru_name</span><span class="p">,</span> <span class="n">bmc_fw_data</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_version&quot;</span> <span class="o">%</span> <span class="n">fru_name</span><span class="p">])</span>
                <span class="p">)</span>
        <span class="n">config_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bmc_fw_data</span><span class="p">)</span>

        <span class="n">bios_vendor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">bios</span><span class="o">.</span><span class="n">get_bios_vendor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bios_vendor</span> <span class="o">!=</span> <span class="s2">&quot;coreboot&quot;</span><span class="p">:</span>
            <span class="c1"># @@@ TODO: Currently can&#39;t collect BIOS settings with coreboot</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;+++Getting BIOS settings&quot;</span><span class="p">)</span>
            <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;bios_settings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cfg_bios_settings</span><span class="p">(</span>
                <span class="n">log_dir</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">bios_dump_filter</span>
            <span class="p">)</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_as_cmd</span><span class="p">(</span><span class="s2">&quot;+++End of Havoc SystemInfo collection&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config_dict</span></div>

<div class="viewcode-block" id="OpenBMC.apply_config_filter"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.apply_config_filter">[docs]</a>    <span class="k">def</span> <span class="nf">apply_config_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove some entries of the config_dict obj</span>

<span class="sd">        @param {} cfg: dictionary that contains systeminfo</span>
<span class="sd">        self.config_filter object structure</span>
<span class="sd">            {</span>
<span class="sd">                &lt;log_to_modify&gt;: {</span>
<span class="sd">                    [&lt;regex_of_string_to_remove&gt;, ...]</span>
<span class="sd">                }, ...</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Applying config check filters: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config_filter</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_filter</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_filter</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
                    <span class="n">cfg</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">cfg</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>
            <span class="c1"># remove newline/tabs</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
                <span class="n">cfg</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpenBMC.update_config_filter"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.update_config_filter">[docs]</a>    <span class="k">def</span> <span class="nf">update_config_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_filter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add additonal filters to the provided config filter</span>
<span class="sd">        object</span>

<span class="sd">        @param {} new_filter: additional config filter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys_wrong_format</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">new_filter</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_filter</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_filter</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config_filter</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_filter</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config_filter</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_filter</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">keys_wrong_format</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keys_wrong_format</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span>
                <span class="s2">&quot;Keys in config filter should be lists of strings. &quot;</span>
                <span class="s2">&quot;Key in wrong format: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keys_wrong_format</span><span class="p">)</span>
            <span class="p">)</span></div>

    <span class="c1"># OEM Related</span>
<div class="viewcode-block" id="OpenBMC.bic_util_reset_boot_order"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.bic_util_reset_boot_order">[docs]</a>    <span class="k">def</span> <span class="nf">bic_util_reset_boot_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;bic-util is not supported on this platform&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.get_cycle_command"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_cycle_command">[docs]</a>    <span class="k">def</span> <span class="nf">get_cycle_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">boot_dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">boot_dic</span><span class="p">[</span><span class="s2">&quot;sled-cycle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/power-util sled-cycle&quot;</span>
        <span class="k">if</span> <span class="n">slot_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slot_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/power-util </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">slot_id</span>
        <span class="n">boot_dic</span><span class="p">[</span><span class="s2">&quot;ac&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;12V-cycle&quot;</span>
        <span class="n">boot_dic</span><span class="p">[</span><span class="s2">&quot;dc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;cycle&quot;</span>
        <span class="n">boot_dic</span><span class="p">[</span><span class="s2">&quot;power-on&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;on&quot;</span>
        <span class="n">boot_dic</span><span class="p">[</span><span class="s2">&quot;power-off&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;off&quot;</span>
        <span class="n">boot_dic</span><span class="p">[</span><span class="s2">&quot;power-status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;status&quot;</span>
        <span class="n">boot_dic</span><span class="p">[</span><span class="s2">&quot;12V-on&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;12V-on&quot;</span>
        <span class="n">boot_dic</span><span class="p">[</span><span class="s2">&quot;12V-off&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;12V-off&quot;</span>
        <span class="n">boot_dic</span><span class="p">[</span><span class="s2">&quot;graceful-shutdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;graceful-shutdown&quot;</span>
        <span class="n">boot_dic</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;reset&quot;</span>
        <span class="k">return</span> <span class="n">boot_dic</span></div>

<div class="viewcode-block" id="OpenBMC.get_fio_trigger_cmd"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_fio_trigger_cmd">[docs]</a>    <span class="k">def</span> <span class="nf">get_fio_trigger_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd_type</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">trigger</span> <span class="o">=</span> <span class="s2">&quot;--trigger=&quot;</span>
        <span class="n">sshpass_cmd</span> <span class="o">=</span> <span class="s2">&quot;sshpass -p 0penBmc &quot;</span>
        <span class="n">sshpass_cmd</span> <span class="o">+=</span> <span class="s2">&quot;ssh -o UserKnownHostsFile=/dev/null root@</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;warm&quot;</span> <span class="ow">in</span> <span class="n">cmd_type</span><span class="p">:</span>
            <span class="n">boot_cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/power-util </span><span class="si">%s</span><span class="s2"> reset&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">trigger</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">sshpass_cmd</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oob_addr</span><span class="p">,</span> <span class="n">boot_cmd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &amp;&#39;&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;30s_ac_cycle&quot;</span> <span class="ow">in</span> <span class="n">cmd_type</span><span class="p">:</span>
            <span class="n">off_cmd</span> <span class="o">=</span> <span class="n">sshpass_cmd</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oob_addr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">()[</span><span class="s2">&quot;12V-off&quot;</span><span class="p">])</span>
            <span class="n">on_cmd</span> <span class="o">=</span> <span class="n">sshpass_cmd</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oob_addr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">()[</span><span class="s2">&quot;12V-on&quot;</span><span class="p">])</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">trigger</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">off_cmd</span> <span class="o">+</span> <span class="s2">&quot;; sleep 30; &quot;</span> <span class="o">+</span> <span class="n">on_cmd</span> <span class="o">+</span> <span class="s2">&quot; &amp;&#39;&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;ac&quot;</span> <span class="ow">in</span> <span class="n">cmd_type</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">trigger</span>
                <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                <span class="o">+</span> <span class="n">sshpass_cmd</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oob_addr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">()[</span><span class="s2">&quot;ac&quot;</span><span class="p">])</span>
                <span class="o">+</span> <span class="s2">&quot; &amp;&#39;&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;dc&quot;</span> <span class="ow">in</span> <span class="n">cmd_type</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">trigger</span>
                <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                <span class="o">+</span> <span class="n">sshpass_cmd</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oob_addr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">()[</span><span class="s2">&quot;dc&quot;</span><span class="p">])</span>
                <span class="o">+</span> <span class="s2">&quot; &amp;&#39;&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;sled-cycle&quot;</span> <span class="ow">in</span> <span class="n">cmd_type</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">trigger</span>
                <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                <span class="o">+</span> <span class="n">sshpass_cmd</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">oob_addr</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">()[</span><span class="s2">&quot;sled-cycle&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; &amp;&#39;&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;graceful-shutdown&quot;</span> <span class="ow">in</span> <span class="n">cmd_type</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">trigger</span>
                <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                <span class="o">+</span> <span class="n">sshpass_cmd</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">oob_addr</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">()[</span><span class="s2">&quot;graceful-shutdown&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; &amp;&#39;&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;No supported trigger command found&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cmd</span></div>

<div class="viewcode-block" id="OpenBMC.dump_bios_to_file"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.dump_bios_to_file">[docs]</a>    <span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">sleep_seconds</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">exponential</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dump_bios_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">):</span>
        <span class="c1"># Dumps the BIOS settings to a file path local to the host</span>
        <span class="c1"># Retryable to avoid failures due to filesystem</span>
        <span class="n">scelnx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scelnx_tool_path</span><span class="p">()</span>
        <span class="n">scelnx</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">scelnx</span><span class="p">,</span> <span class="s2">&quot;/opt/&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;/tmp/&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> /o /s </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scelnx</span><span class="p">,</span> <span class="n">log_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">log_file</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.get_scelnx_tool_path"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_scelnx_tool_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_scelnx_tool_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tool_path</span> <span class="o">=</span> <span class="n">SiteUtils</span><span class="p">()</span><span class="o">.</span><span class="n">get_tool_path</span><span class="p">()</span>
        <span class="n">scelnx</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tool_path</span><span class="p">,</span> <span class="s2">&quot;SCELNX_64&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scelnx</span></div>

    <span class="k">def</span> <span class="nf">_get_cfg_bios_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">bios_filter</span><span class="p">):</span>
        <span class="c1"># Bios settings are very huge, so we only store them in a local file and</span>
        <span class="c1"># then at the end run a diff of the 2 files</span>
        <span class="n">bios_dump_start</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s2">&quot;bios_settings_start.dump&quot;</span><span class="p">)</span>
        <span class="n">bios_dump_end</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s2">&quot;bios_settings_end.dump&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
            <span class="n">bios_dump_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">bios</span><span class="o">.</span><span class="n">get_bios_settings_dump</span><span class="p">(</span><span class="n">bios_dump_start</span><span class="p">)</span>
            <span class="c1">#utils.copy_file(self.host, bios_dump_start, log_dir, force=True)</span>
            <span class="n">bios_settings</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bios_dump_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">bios</span><span class="o">.</span><span class="n">get_bios_settings_dump</span><span class="p">(</span><span class="n">bios_dump_end</span><span class="p">)</span>
            <span class="c1">#utils.copy_file(self.host, bios_dump_end, log_dir, force=True)</span>
            <span class="n">bios_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">bios</span><span class="o">.</span><span class="n">get_bios_diff</span><span class="p">(</span>
                <span class="n">bios_dump_start</span><span class="p">,</span>
                <span class="n">bios_dump_end</span><span class="p">,</span>
                <span class="n">bios_filter</span><span class="o">=</span><span class="n">bios_filter</span><span class="p">,</span>
                <span class="n">save_after_bios</span><span class="o">=</span><span class="kc">True</span>

            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bios_settings</span><span class="p">)</span>

<div class="viewcode-block" id="OpenBMC.get_log_util_errors"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_log_util_errors">[docs]</a>    <span class="k">def</span> <span class="nf">get_log_util_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_start_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string of errors written to log-util since the test began</span>
<span class="sd">        Some known errors are ignored and won&#39;t be included in the filtered log</span>

<span class="sd">        @param Float test_start_time: epoch time when test begins</span>
<span class="sd">        @return String: line-separated errors seen during test</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">log_util_all_options</span><span class="p">()</span>  <span class="c1"># a list of logs</span>
        <span class="n">filtered_logs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
            <span class="n">filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_sel_log</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(),</span> <span class="n">test_start_time</span><span class="p">)</span>
            <span class="n">filtered_logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filtered_logs</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpenBMC.filter_sel_log"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.filter_sel_log">[docs]</a>    <span class="k">def</span> <span class="nf">filter_sel_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">test_start_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter system event log and retain only relevant entries for config</span>
<span class="sd">            check. Also filter out some known errors.</span>

<span class="sd">        @param String[] log: list of SEL entries</span>
<span class="sd">        @param Float test_start_time: epoch time when test begins</span>
<span class="sd">        @return String: filtered SEL log</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_out_empty_lines</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_out_log_before_test</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">test_start_time</span><span class="p">)</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_err_sel_log</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span>

        <span class="c1"># combine lines into one string</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.filter_err_sel_log"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.filter_err_sel_log">[docs]</a>    <span class="k">def</span> <span class="nf">filter_err_sel_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return SEL entries with errors</span>

<span class="sd">        @param String[] log: list of SEL entries</span>
<span class="sd">        @return String[]: list of filtered SEL output</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors_found</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">error_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;ERR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;exception&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;abnormal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Crashdump&quot;</span><span class="p">,</span>
            <span class="s2">&quot;0x41&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Assertion&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">known_errors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;ssh_dispatch_run_fatal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal: mm_request_send&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal: mm_request_receive&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Sensor: IOC_TEMP (0x61)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PCIE_ERR (0x41)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PCIeErr(0x20)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Sensor: POST_ERROR (0x2B)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Sensor: ME_POWER_STATE (0x16)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NIC error:Rsp:0x0000&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MB_Throttle Assertion&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Manufacturing error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;(A00901) Firmware Exception&quot;</span><span class="p">,</span>
            <span class="s2">&quot;(A00904) Firmware Exception&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OEM Post Code 0xA104 Assertion&quot;</span><span class="p">,</span>
            <span class="s2">&quot;(A00903) Firmware Exception&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NCSI AEN rcvd:&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Sensor: SYSTEM_STATUS (0x10)&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">log</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">error_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">errors_found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors_found</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="nb">filter</span> <span class="ow">in</span> <span class="n">known_errors</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">filter</span> <span class="ow">in</span> <span class="n">error</span><span class="p">:</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filtered</span></div>

<div class="viewcode-block" id="OpenBMC.filter_out_empty_lines"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.filter_out_empty_lines">[docs]</a>    <span class="k">def</span> <span class="nf">filter_out_empty_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">):</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">log</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filtered</span></div>

<div class="viewcode-block" id="OpenBMC.filter_out_log_before_test"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.filter_out_log_before_test">[docs]</a>    <span class="k">def</span> <span class="nf">filter_out_log_before_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">test_start_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of log entries that were added after test begin</span>

<span class="sd">        @param String[]: list of log entries</span>
<span class="sd">        @param Float test_start_time: epoch time when test begins</span>
<span class="sd">        @return String[]: list of log entries after test begin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_re</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(\d</span><span class="si">{4}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2">\s\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">)&quot;</span>
        <span class="n">log_reversed</span> <span class="o">=</span> <span class="n">log</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">log_during_test_reversed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">log_reversed</span><span class="p">:</span>
            <span class="c1"># sel entries have timestamps</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">time_re</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">time_str</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">time_str_to_epoch</span><span class="p">(</span><span class="n">OpenBMC</span><span class="o">.</span><span class="n">SEL_TIME_FORMAT</span><span class="p">,</span> <span class="n">time_str</span><span class="p">)</span>
                <span class="c1"># stop looking after find a line added</span>
                <span class="c1"># earlier than the test start time</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">test_start_time</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">log_during_test_reversed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">log_during_test_reversed</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="OpenBMC.filter_sensor_log"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.filter_sensor_log">[docs]</a>    <span class="k">def</span> <span class="nf">filter_sensor_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collect field names from sensor log</span>

<span class="sd">        @return String[]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">field_re</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^((.+)(\(0x\w\w?\))?)\s*:&quot;</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">field_re</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">filtered</span></div>

    <span class="c1">#Check the logutil for CATERR that was induced</span>
<div class="viewcode-block" id="OpenBMC.check_sel_log_caterr"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.check_sel_log_caterr">[docs]</a>    <span class="k">def</span> <span class="nf">check_sel_log_caterr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp_now</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">log_message</span><span class="p">()</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.*(\btimestamp_now\b)*(\bCATERR\b)&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_crash_dump_path</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;No CATERR entry in SEL log&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;CATERR not generated&quot;</span><span class="p">)</span></div>

    <span class="c1">#Crashdump will take some time to complete</span>
    <span class="c1">#wait until it is done usually takes 10 to 30 min</span>
<div class="viewcode-block" id="OpenBMC.check_crash_dump_path"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.check_crash_dump_path">[docs]</a>    <span class="k">def</span> <span class="nf">check_crash_dump_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">proc_status</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">proc_status</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;ps | grep autodump.sh | grep -v grep&quot;</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">proc_status</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.*\s*(</span><span class="si">{autodump.sh}</span><span class="s1">)\s+&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
                    <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Collecting crashdump in progress &quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Running autodump process is complete &quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">proc_status</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Crash dump process is completed&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.collect_dump"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.collect_dump">[docs]</a>    <span class="k">def</span> <span class="nf">collect_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">):</span>
        <span class="n">crashdump_file</span> <span class="o">=</span> <span class="s2">&quot;/mnt/data/crashdump_</span><span class="si">%s</span><span class="s2">.tar.gz&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">crashdump_file</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;zcat </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">crashdump_file</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

                <span class="n">dump_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s2">&quot;crash_dump.log&quot;</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dump_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">target_file</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">target_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">target_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
                    <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Collected dump logs: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dump_file</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;zcat: </span><span class="si">%s</span><span class="s2">: No such file or directory&quot;</span> <span class="o">%</span> <span class="n">crashdump_file</span>
                <span class="k">if</span> <span class="n">err</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OpenBMC.get_crash_dump"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_crash_dump">[docs]</a>    <span class="k">def</span> <span class="nf">get_crash_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">caterr</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rename crash_dump at the start of the test as crash_dump.start.log if exists</span>
<span class="sd">        Rename crash_dump at the end of the test as crash_dump.end.log</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">crashdump_file</span> <span class="o">=</span> <span class="s2">&quot;/mnt/data/crashdump_</span><span class="si">%s</span><span class="s2">.tar.gz&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">)</span>
        <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collect_dump</span><span class="p">(</span><span class="n">log_dir</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dump</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">log_dir</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dump</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;crash_dump.log&quot;</span><span class="p">):</span>
                    <span class="n">cur_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="n">dump</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
                        <span class="n">target_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="n">dump</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;start.log&#39;</span><span class="p">)</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">cur_dir</span><span class="p">,</span> <span class="n">target_file</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">target_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="n">dump</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;end.log&#39;</span><span class="p">)</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">cur_dir</span><span class="p">,</span> <span class="n">target_file</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">caterr</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">check_crash_dump_occurrence</span><span class="p">(</span><span class="n">log_dir</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;zcat: </span><span class="si">%s</span><span class="s2">: No such file or directory&quot;</span> <span class="o">%</span> <span class="n">crashdump_file</span>
            <span class="k">if</span> <span class="n">err</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OpenBMC.check_crash_dump_occurrence"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.check_crash_dump_occurrence">[docs]</a>    <span class="k">def</span> <span class="nf">check_crash_dump_occurrence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if a new crash dump occured while performing the test</span>
<span class="sd">        Pass Caterr injection test,Fail all the other tests</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_difference</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">crashdump</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">start_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s2">&quot;crash_dump.start.log&quot;</span><span class="p">)</span>
        <span class="n">end_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s2">&quot;crash_dump.end.log&quot;</span><span class="p">)</span>
        <span class="n">start_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">start_path</span><span class="p">)</span>
        <span class="n">end_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">end_path</span><span class="p">)</span>
        <span class="c1"># if both crash_dump.start.log and crash_dump.end.log exists</span>
        <span class="k">if</span> <span class="n">start_exists</span> <span class="ow">and</span> <span class="n">end_exists</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">start_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_start</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">end_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_end</span><span class="p">:</span>
                    <span class="n">difference</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">file_start</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">file_end</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">difference</span><span class="p">:</span>
                        <span class="n">check_difference</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># if &quot;No crash dump available&quot; at the start</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">start_exists</span> <span class="ow">and</span> <span class="n">end_exists</span><span class="p">:</span>
            <span class="n">crashdump</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">check_difference</span> <span class="ow">or</span> <span class="n">crashdump</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed, Crashdump occured during the Test,&quot;</span>
                    <span class="s2">&quot; logs at </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">end_path</span><span class="p">))</span></div>

<div class="viewcode-block" id="OpenBMC.get_system_logs"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_system_logs">[docs]</a>    <span class="k">def</span> <span class="nf">get_system_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/log-util all --print&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">ignore_status</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.clear_system_logs"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.clear_system_logs">[docs]</a>    <span class="k">def</span> <span class="nf">clear_system_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/log-util all --clear&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.is_wedge"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.is_wedge">[docs]</a>    <span class="k">def</span> <span class="nf">is_wedge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpenBMC.status"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.status">[docs]</a>    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_openbmc_mac</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="OpenBMC.openbmc_manufacturer_check"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.openbmc_manufacturer_check">[docs]</a>    <span class="k">def</span> <span class="nf">openbmc_manufacturer_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Currently OpenBMC FW is maintained by Facebook and</span>
        <span class="c1"># Manufacturer ID is unique (40981) for server with OpenBMC</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;ipmitool mc info&quot;</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Manufacturer ID\s+:\s+(\d+)&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">man_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">man_id</span> <span class="o">==</span> <span class="mi">40981</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpenBMC.sled_cycle"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.sled_cycle">[docs]</a>    <span class="k">def</span> <span class="nf">sled_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">post_health_check</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;ipmitool raw 0x06 0x05 0x73 0x6c 0x65 0x64 0x2d 0x63 0x79 0x63 0x6c 0x65&quot;</span>
        <span class="n">current_reboot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">get_last_reboot</span><span class="p">()</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Inband Sled cycle&quot;</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;No response, Trying to reconnect&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">post_health_check</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">system_health_check</span><span class="p">(</span><span class="n">current_reboot</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_handler</span><span class="o">.</span><span class="n">add_cmd_metric</span><span class="p">(</span>
                <span class="s2">&quot;reconnect after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_cycle_check</span><span class="p">()</span></div>

    <span class="c1"># Power Status of Slot</span>
<div class="viewcode-block" id="OpenBMC.power_status"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.power_status">[docs]</a>    <span class="k">def</span> <span class="nf">power_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">boot_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">boot_cmd</span><span class="p">[</span><span class="s2">&quot;power-status&quot;</span><span class="p">]</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing OpenBMC </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.check_powered_on"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.check_powered_on">[docs]</a>    <span class="k">def</span> <span class="nf">check_powered_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">power_status</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ON&#39;</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpenBMC.check_powered_12V_on"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.check_powered_12V_on">[docs]</a>    <span class="k">def</span> <span class="nf">check_powered_12V_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">power_status</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;12V-OFF&#39;</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="OpenBMC.cmos_clear"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.cmos_clear">[docs]</a>    <span class="k">def</span> <span class="nf">cmos_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">last_reboot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;bic-util </span><span class="si">%s</span><span class="s2"> 0xe0 0x25 0x15 0xa0 0x00&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slot_info</span><span class="p">())</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;CMOS Reset </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cmd</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">system_health_check</span><span class="p">(</span><span class="n">last_reboot</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_handler</span><span class="o">.</span><span class="n">add_cmd_metric</span><span class="p">(</span>
            <span class="s2">&quot;reconnect after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_powered_on</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;Failed to power on after cmos reset &quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.bmc_reset"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.bmc_reset">[docs]</a>    <span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sleep_seconds</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">bmc_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;ipmitool&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot; mc reset cold&quot;</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Inband BMC Reset&quot;</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, wait 120s: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cmd</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;BMC reset FAILED&quot;</span><span class="p">)</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="c1"># For some tiogapass servers it takes more time, so trying in a loop</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">total_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;BMC is successfully up after </span><span class="si">%s</span><span class="s2"> sec&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total_time</span><span class="p">))</span>
            <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;IPMI command was successful, however BMC reset failed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_cycle_check</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.validate_powered_on"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.validate_powered_on">[docs]</a>    <span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sleep_seconds</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_powered_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_powered_on</span><span class="p">()</span></div>

    <span class="c1"># OEM Related</span>
<div class="viewcode-block" id="OpenBMC.clear_boot_order_cmos"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.clear_boot_order_cmos">[docs]</a>    <span class="k">def</span> <span class="nf">clear_boot_order_cmos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fru</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/bios-util&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> --boot_order enable --clear_CMOS&quot;</span> <span class="o">%</span> <span class="n">fru</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

    <span class="c1"># OEM Get the current boot order</span>
<div class="viewcode-block" id="OpenBMC.get_current_boot_order"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_current_boot_order">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_boot_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/bios-util &quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> --boot_order get --boot_order&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span>
        <span class="n">current_seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">current_seq</span></div>

    <span class="c1"># OEM Set the boot order</span>
    <span class="sd">&#39;&#39;&#39;Currently BMC is sending 255 as fifth</span>
<span class="sd">       argument from bmc instead of 4 for quanta</span>
<span class="sd">       can have it reverted once ODM confirms&#39;&#39;&#39;</span>
<div class="viewcode-block" id="OpenBMC.get_random_boot_order"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_random_boot_order">[docs]</a>    <span class="k">def</span> <span class="nf">get_random_boot_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">random_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">random_num</span><span class="p">)</span>
        <span class="n">shuffle_num</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">random_num</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">shuffle_num</span></div>

    <span class="c1"># OEM Set HDD as last boot order</span>
    <span class="sd">&#39;&#39;&#39; options &#39;2&#39; is HDD, check if its</span>
<span class="sd">        the last boot order, if not move it to last</span>
<span class="sd">        boot order, 255 will set to Reserved/USB</span>
<span class="sd">        hence we can ignore 255 for quanta&#39;&#39;&#39;</span>
<div class="viewcode-block" id="OpenBMC.shuffle_boot_order"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.shuffle_boot_order">[docs]</a>    <span class="k">def</span> <span class="nf">shuffle_boot_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
        <span class="n">last_seq</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
        <span class="n">make</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">get_manufacturer</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">last_seq</span> <span class="o">!=</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
            <span class="n">tmp_seq</span> <span class="o">=</span> <span class="n">seq</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
            <span class="n">make</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">get_manufacturer</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
            <span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">seq</span><span class="p">[</span><span class="n">tmp_seq</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="n">tmp_seq</span><span class="p">],</span> <span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">shuffle_seq</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shuffle_seq</span> <span class="o">=</span> <span class="n">seq</span>
        <span class="k">if</span> <span class="n">make</span> <span class="o">==</span> <span class="s2">&quot;quanta&quot;</span><span class="p">:</span>
            <span class="n">shuffle_seq</span> <span class="o">=</span> <span class="n">shuffle_seq</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;255&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shuffle_seq</span></div>

    <span class="c1"># OEM Set the boot order</span>
<div class="viewcode-block" id="OpenBMC.set_current_boot_order"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.set_current_boot_order">[docs]</a>    <span class="k">def</span> <span class="nf">set_current_boot_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_seq</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/bios-util &quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> --boot_order set --boot_order </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">,</span> <span class="n">random_seq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

    <span class="c1"># bios-util</span>
<div class="viewcode-block" id="OpenBMC.get_post_code"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_post_code">[docs]</a>    <span class="k">def</span> <span class="nf">get_post_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/bios-util &quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> --postcode get&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># bios-util</span>
<div class="viewcode-block" id="OpenBMC.get_plat_info"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_plat_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_plat_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/bios-util &quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> --plat_info get&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># In OpenBMC sled-cycle, resets OpenBMC and all four slots</span>
<div class="viewcode-block" id="OpenBMC.power_reset"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.power_reset">[docs]</a>    <span class="k">def</span> <span class="nf">power_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1200</span><span class="p">):</span>
        <span class="n">boot_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">boot_cmd</span><span class="p">[</span><span class="s2">&quot;sled-cycle&quot;</span><span class="p">]</span>
        <span class="n">current_reboot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">get_last_reboot</span><span class="p">()</span>
        <span class="n">bmc_last_reboot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">get_last_reboot</span><span class="p">()</span>

        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Cycling now: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Command will not return status.</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:No response expected. Trying to reconnect&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">system_health_check</span><span class="p">(</span>
            <span class="n">current_reboot</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">bmc_last_reboot</span><span class="p">,</span> <span class="n">bmc_reconnect_timeout</span><span class="o">=</span><span class="mi">180</span>
        <span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_handler</span><span class="o">.</span><span class="n">add_cmd_metric</span><span class="p">(</span>
            <span class="s2">&quot;reconnect after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_cycle_check</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpenBMC.power_util_reset"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.power_util_reset">[docs]</a>    <span class="k">def</span> <span class="nf">power_util_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">reboot_check</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">boot_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">boot_cmd</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">reboot_check</span><span class="p">:</span>
            <span class="n">current_reboot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">get_last_reboot</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_reboot</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Cycling now: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> Reset command failed, trying to reconnect&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">system_health_check</span><span class="p">(</span><span class="n">current_reboot</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_handler</span><span class="o">.</span><span class="n">add_cmd_metric</span><span class="p">(</span>
            <span class="s2">&quot;reconnect after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_cycle_check</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpenBMC.ac_cycle"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.ac_cycle">[docs]</a>    <span class="k">def</span> <span class="nf">ac_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">reboot_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">boot_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">boot_cmd</span><span class="p">[</span><span class="s2">&quot;ac&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">reboot_check</span><span class="p">:</span>
            <span class="n">last_reboot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">get_last_reboot</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">last_reboot</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_ac_cycle</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="c1"># Command failed, system might either be rebooting already or</span>
            <span class="c1"># command failed to go through, in this case try again</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">reconnect</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># Host is not accessible, so most likely the cmd went through.</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Host is still accessible, so try again:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_try_ac_cycle</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">system_health_check</span><span class="p">(</span><span class="n">last_reboot</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_handler</span><span class="o">.</span><span class="n">add_cmd_metric</span><span class="p">(</span>
            <span class="s2">&quot;reconnect after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_cycle_check</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_powered_on</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to power on.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;12V Power cycling fru ...&quot;</span></div>

    <span class="k">def</span> <span class="nf">_try_ac_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;AC Cycling now: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># DC Cycle</span>
<div class="viewcode-block" id="OpenBMC.cycle"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.cycle">[docs]</a>    <span class="k">def</span> <span class="nf">cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">reboot_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">post_health_check</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">boot_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">boot_cmd</span><span class="p">[</span><span class="s2">&quot;dc&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">reboot_check</span><span class="p">:</span>
            <span class="n">current_reboot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">get_last_reboot</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_reboot</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Cycling now: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span>
                <span class="s2">&quot;OpenBMC Cycle command failed, trying to reconnect anyhow&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">post_health_check</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">system_health_check</span><span class="p">(</span><span class="n">current_reboot</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_handler</span><span class="o">.</span><span class="n">add_cmd_metric</span><span class="p">(</span>
                <span class="s2">&quot;reconnect after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_cycle_check</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpenBMC.power_on"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.power_on">[docs]</a>    <span class="k">def</span> <span class="nf">power_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">last_reboot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">boot_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">boot_cmd</span><span class="p">[</span><span class="s2">&quot;power-on&quot;</span><span class="p">]</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Powering on now: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">system_health_check</span><span class="p">(</span><span class="n">last_reboot</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_handler</span><span class="o">.</span><span class="n">add_cmd_metric</span><span class="p">(</span>
            <span class="s2">&quot;reconnect after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_powered_on</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to power on.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.power_off"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.power_off">[docs]</a>    <span class="k">def</span> <span class="nf">power_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">):</span>
        <span class="n">boot_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">boot_cmd</span><span class="p">[</span><span class="s2">&quot;power-off&quot;</span><span class="p">]</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Powering OFF now: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="n">success</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">:</span>
            <span class="c1"># Sleep for some time to let shutdown complete</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_handler</span><span class="o">.</span><span class="n">add_cmd_metric</span><span class="p">(</span>
            <span class="s2">&quot;disconnect after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to power down system&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Power Down complete&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.twelve_volt_on"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.twelve_volt_on">[docs]</a>    <span class="k">def</span> <span class="nf">twelve_volt_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">last_reboot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The command is 12V on which powers on the</span>
<span class="sd">        motherboard with the CPU still in the off state</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">boot_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">boot_cmd</span><span class="p">[</span><span class="s2">&quot;12V-on&quot;</span><span class="p">]</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Issuing 12V-on now: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">system_health_check</span><span class="p">(</span><span class="n">last_reboot</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_handler</span><span class="o">.</span><span class="n">add_cmd_metric</span><span class="p">(</span>
            <span class="s2">&quot;reconnect after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.twelve_volt_off"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.twelve_volt_off">[docs]</a>    <span class="k">def</span> <span class="nf">twelve_volt_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The command is 12V off which powers off the</span>
<span class="sd">        motherboard</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">boot_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">boot_cmd</span><span class="p">[</span><span class="s2">&quot;12V-off&quot;</span><span class="p">]</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Powering OFF (12v) now: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="n">success</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">:</span>
            <span class="c1"># Sleep for some time to let shutdown complete</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to power down system&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Power Down complete&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.ac_on_off_fullcycle"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.ac_on_off_fullcycle">[docs]</a>    <span class="k">def</span> <span class="nf">ac_on_off_fullcycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">last_reboot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This method does AC 12V off and 12V on from oob</span>
<span class="sd">        on all the platforms except on tiogapass which does</span>
<span class="sd">        not have any of 12V cycle command support</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">boot_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">boot_cmd</span><span class="p">[</span><span class="s2">&quot;12V-off&quot;</span><span class="p">]</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Powering OFF (12v) now: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">:</span>
            <span class="c1"># Sleep for some time to let shutdown complete</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to power down system&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Power Down complete&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">boot_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">boot_cmd</span><span class="p">[</span><span class="s2">&quot;12V-on&quot;</span><span class="p">]</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Issuing 12V-on now: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">system_health_check</span><span class="p">(</span><span class="n">last_reboot</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_handler</span><span class="o">.</span><span class="n">add_cmd_metric</span><span class="p">(</span>
            <span class="s2">&quot;reconnect after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span></div>

    <span class="c1"># Slot FRUs</span>
<div class="viewcode-block" id="OpenBMC.fru_list"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.fru_list">[docs]</a>    <span class="k">def</span> <span class="nf">fru_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">slot_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slot_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fruid-util </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">slot_id</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># Get All FRUs</span>
<div class="viewcode-block" id="OpenBMC.all_fru_list"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.all_fru_list">[docs]</a>    <span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sleep_seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">all_fru_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fruid-util all&quot;</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">ignore_status</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Server Board [0-4] is unavailable!&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">status</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span></div>

    <span class="c1"># Dump the file with fru options</span>
<div class="viewcode-block" id="OpenBMC.dump_fru_list"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.dump_fru_list">[docs]</a>    <span class="k">def</span> <span class="nf">dump_fru_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">int_value</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fruid-util </span><span class="si">%s</span><span class="s2"> --dump file</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">int_value</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Fruid-util dump to a file failed&quot;</span><span class="p">)</span></div>

    <span class="c1"># Get complete fruid options</span>
<div class="viewcode-block" id="OpenBMC.get_full_fruid_list"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_full_fruid_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_full_fruid_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_fru_list</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fru_list</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># Slot sensors</span>
<div class="viewcode-block" id="OpenBMC.sensor_data"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.sensor_data">[docs]</a>    <span class="k">def</span> <span class="nf">sensor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;sensor-util </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># Get PV_BAT value from sensor_data</span>
<div class="viewcode-block" id="OpenBMC.get_pv_bat_sensor_data"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_pv_bat_sensor_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_pv_bat_sensor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">sensor_data</span><span class="p">()</span>
        <span class="n">match_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;BAT\s+\(\w+\)\s*:\s*(\d+\.\d*)&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">match_str</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">pv_bat_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">pv_bat_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;Unable to get pv_bat_sensor_data&quot;</span><span class="p">)</span></div>

    <span class="c1"># Get MB_P3V_BAT value from sensor_data</span>
<div class="viewcode-block" id="OpenBMC.get_p3v3_mb_sensor_data"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_p3v3_mb_sensor_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_p3v3_mb_sensor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">sensor_data</span><span class="p">()</span>
        <span class="n">match_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?:MB_P3V3|P3V3_MB)\s+\(\w+\)\s*:\s*(\d+\.\d*)&quot;</span>
        <span class="c1"># Sample match strings</span>
        <span class="c1"># P3V3_MB (0xD1) : 3.28 Volts | (ok)</span>
        <span class="c1"># MB_P3V3 (0xD1): 3.3</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">match_str</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">p3v3_mb_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">p3v3_mb_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;Unable to get p3v3_mb_value&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.sensor_data_history"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.sensor_data_history">[docs]</a>    <span class="k">def</span> <span class="nf">sensor_data_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeframe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param String timeframe: timeframe to collect sensor log</span>
<span class="sd">            Format: number in seconds, or a number followed by [m/h/d]</span>
<span class="sd">            (minutes/hour/day)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;sensor-util </span><span class="si">%s</span><span class="s2"> --history </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">,</span> <span class="n">timeframe</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">ignore_status</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># vboot option to check the error code</span>
<div class="viewcode-block" id="OpenBMC.vboot_util"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.vboot_util">[docs]</a>    <span class="k">def</span> <span class="nf">vboot_util</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;vboot-util&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># NIC sensors</span>
<div class="viewcode-block" id="OpenBMC.nic_sensor_data"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.nic_sensor_data">[docs]</a>    <span class="k">def</span> <span class="nf">nic_sensor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;sensor-util nic&quot;</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># Get All sensors</span>
<div class="viewcode-block" id="OpenBMC.all_sensor_data"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.all_sensor_data">[docs]</a>    <span class="k">def</span> <span class="nf">all_sensor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;sensor-util all&quot;</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">ignore_status</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.all_sensor_data_history"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.all_sensor_data_history">[docs]</a>    <span class="k">def</span> <span class="nf">all_sensor_data_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeframe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param String timeframe: timeframe to collect sensor log</span>
<span class="sd">            Format: number in seconds, or a number followed by [m/h/d]</span>
<span class="sd">            (minutes/hour/day)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;sensor-util all --history </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">timeframe</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">ignore_status</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.get_sensor_util_history"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_sensor_util_history">[docs]</a>    <span class="k">def</span> <span class="nf">get_sensor_util_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_start_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function collects sensor_history for the</span>
<span class="sd">        duration of test</span>
<span class="sd">        sensor-util all --history duration will give max,</span>
<span class="sd">        min and avg values for the duration of test.</span>
<span class="sd">        @param Float test_start_time: epoch time when test begins</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">test_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">test_duration</span> <span class="o">=</span> <span class="n">test_end</span> <span class="o">-</span> <span class="n">test_start_time</span>
        <span class="n">sensor_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_sensor_data_history</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">test_duration</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">sensor_data</span></div>

<div class="viewcode-block" id="OpenBMC.collect_sensor_history"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.collect_sensor_history">[docs]</a>    <span class="k">def</span> <span class="nf">collect_sensor_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">test_start_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collect sensor log for the duration of test</span>
<span class="sd">        @param log_dir: will store sensor_data.log in this directory</span>
<span class="sd">        @param Float test_start_time: epoch time when test begins</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sensor_history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sensor_util_history</span><span class="p">(</span><span class="n">test_start_time</span><span class="p">)</span>
        <span class="n">sensor_log</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s2">&quot;sensor_data.log&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sensor_log</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">target_file</span><span class="p">:</span>
            <span class="n">target_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sensor_history</span><span class="p">)</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span>
                <span class="s2">&quot;Collected Sensor information: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sensor_log</span><span class="p">)</span>
            <span class="p">)</span></div>

    <span class="c1"># Get full sensor data for a given slot, does not include other slots data</span>
<div class="viewcode-block" id="OpenBMC.get_full_sensor_data"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_full_sensor_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_full_sensor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_sensor_data</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">sensor_data</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nic_sensor_data</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># Log Util</span>
<div class="viewcode-block" id="OpenBMC.log_message"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.log_message">[docs]</a>    <span class="k">def</span> <span class="nf">log_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;log-util </span><span class="si">%s</span><span class="s2"> --print&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.log_util_nic"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.log_util_nic">[docs]</a>    <span class="k">def</span> <span class="nf">log_util_nic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;log-util nic --print&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.log_util_sys"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.log_util_sys">[docs]</a>    <span class="k">def</span> <span class="nf">log_util_sys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;log-util sys --print&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.log_util_all_options"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.log_util_all_options">[docs]</a>    <span class="k">def</span> <span class="nf">log_util_all_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">log_message</span><span class="p">())</span>
        <span class="n">logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_util_nic</span><span class="p">())</span>
        <span class="n">logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_util_sys</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">logs</span></div>

<div class="viewcode-block" id="OpenBMC.log_util_all"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.log_util_all">[docs]</a>    <span class="k">def</span> <span class="nf">log_util_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;log-util all --print&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># Get and Set Fan Speed</span>
<div class="viewcode-block" id="OpenBMC.get_fan_speed"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_fan_speed">[docs]</a>    <span class="k">def</span> <span class="nf">get_fan_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fan-util --get&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.get_individual_fan_speed"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_individual_fan_speed">[docs]</a>    <span class="k">def</span> <span class="nf">get_individual_fan_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fan_number</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fan-util --get </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fan_number</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.set_fan_speed"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.set_fan_speed">[docs]</a>    <span class="k">def</span> <span class="nf">set_fan_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">,</span> <span class="n">zone_num</span><span class="p">,</span> <span class="n">fan_num</span><span class="p">):</span>
        <span class="c1"># stop fan daemon before performing set</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;stopping fan daemon&quot;</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;sv stop fscd&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fan-util --set </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">percent</span><span class="p">,</span> <span class="n">zone_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># wait for fan speed to change</span>
        <span class="c1"># Restart the fan daemon</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Restarting fan daemon&quot;</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;sv start fscd&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fan_speed</span><span class="p">()</span>
        <span class="n">fan_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_fans_percentage</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="n">fan_speed_percentage</span> <span class="o">=</span> <span class="n">fan_speed</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="n">fan_num</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\((.*)%\)&quot;</span><span class="p">,</span> <span class="n">fan_speed_percentage</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">fan_speed_percentage_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;Failed to set fan speed&quot;</span><span class="p">)</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Percentage changed to </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fan_speed_percentage_int</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_fan_speed</span><span class="p">(</span><span class="n">fan_speed_percentage_int</span><span class="p">,</span> <span class="n">percent</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.validate_fan_speed"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.validate_fan_speed">[docs]</a>    <span class="k">def</span> <span class="nf">validate_fan_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percentage_got</span><span class="p">,</span> <span class="n">percentage_given_by_user</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">percentage_given_by_user</span><span class="p">)</span> <span class="o">==</span> <span class="n">percentage_got</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Percentage is successfully set to desired value&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;Failed to set fan speed to desired value&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.get_fan_info"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_fan_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_fan_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The total number of fans on each platform varies(ex: 2 or 8)</span>
<span class="sd">        get each fan number (ex: Fan 0, Fan 1) in a list.</span>
<span class="sd">        Filter the output which has additional</span>
<span class="sd">        details not pertaining to fan number or speed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fan_speed</span><span class="p">()</span>
        <span class="n">fan_info</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fan_info</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;RPM&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span> <span class="n">fan_info</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fan_info</span><span class="p">:</span>
            <span class="c1">#For lightning, one extra line with warning is added in the output</span>
            <span class="k">if</span> <span class="s2">&quot;Warning&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">fans_list</span> <span class="o">=</span> <span class="n">fan_info</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fans_list</span> <span class="o">=</span> <span class="n">fan_info</span>
        <span class="k">return</span> <span class="n">fans_list</span></div>

<div class="viewcode-block" id="OpenBMC.verify_valid_fan_info"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.verify_valid_fan_info">[docs]</a>    <span class="k">def</span> <span class="nf">verify_valid_fan_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the fan speed of each individual fan with get option</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing fan_util --get option&quot;</span><span class="p">)</span>
        <span class="n">fans_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fan_info</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fan_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fans_list</span><span class="p">)):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_individual_fan_speed</span><span class="p">(</span><span class="n">fan_number</span><span class="p">)</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;fan&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
            <span class="n">is_valid_output</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">is_valid_output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;Failed to get fan speed&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="OpenBMC.get_all_fans_percentage"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_all_fans_percentage">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_fans_percentage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">parsed_output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;RPM&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">after_colon</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">after_colon</span> <span class="o">=</span> <span class="n">after_colon</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">parsed_output</span> <span class="o">+=</span> <span class="n">after_colon</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">parsed_output</span></div>

<div class="viewcode-block" id="OpenBMC.verify_flash_sensors"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.verify_flash_sensors">[docs]</a>    <span class="k">def</span> <span class="nf">verify_flash_sensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="c1">#AVA flash sensors</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="OpenBMC.run_obmccmd"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.run_obmccmd">[docs]</a>    <span class="k">def</span> <span class="nf">run_obmccmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obmccmd</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">option</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">obmccmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">obmccmd</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># OpenBMC FW</span>
<div class="viewcode-block" id="OpenBMC.get_openbmc_version"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_openbmc_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_openbmc_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;cat /etc/issue&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;OpenBMC\sRelease\s(\w+-\S+)&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get OpenBMC FW version&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.get_me_fw_version"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_me_fw_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_me_fw_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fw_util</span><span class="p">()</span>

        <span class="c1"># Get the ME FW version from fw-util output</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;ME\sVersion:\s(.*)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get ME FW version&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.get_cpld_fw_version"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_cpld_fw_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_cpld_fw_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fw_util</span><span class="p">()</span>

        <span class="c1"># Get the ME FW version from fw-util output</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;CPLD\sVersion:\s(\d+x\d+)&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get CPLD FW version&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.get_bios_version"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_bios_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_bios_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fw_util</span><span class="p">()</span>

        <span class="c1"># Get the BIOS version from fw-util output</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;BIOS\sVersion:\s(\w+.\w+)&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get BIOS version&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.get_bridge_ic_version"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_bridge_ic_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_bridge_ic_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fw_util</span><span class="p">()</span>

        <span class="c1"># Get the BIOS version from fw-util output</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Bridge-IC\sVersion:\s(\w+.\w+)&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get BRIDGE IC version&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.get_bridgeic_bootloader_version"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_bridgeic_bootloader_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_bridgeic_bootloader_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fw_util</span><span class="p">()</span>
        <span class="c1"># get bic_bootloader version from output</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Bridge-IC\sBootloader\sVersion:\s(\w+.\w+)&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get BiC bootloader version&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.get_openbmc_mac"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_openbmc_mac">[docs]</a>    <span class="k">def</span> <span class="nf">get_openbmc_mac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_obmccmd</span><span class="p">(</span><span class="s2">&quot;ifconfig&quot;</span><span class="p">,</span> <span class="s2">&quot;eth0&quot;</span><span class="p">)</span>

        <span class="c1"># Get the OpenBMC MAC address</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;HWaddr\s(([0-9A-Fa-f]</span><span class="si">{2}</span><span class="s2">[:-])</span><span class="si">{5}</span><span class="s2">([0-9A-Fa-f]</span><span class="si">{2}</span><span class="s2">))&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get OpenBMC MAC Address&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.fw_util"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.fw_util">[docs]</a>    <span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">sleep_seconds</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">exponential</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fw_util</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">slot_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slot_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fw-util </span><span class="si">%s</span><span class="s2"> --version&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">slot_id</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.fw_util_all"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.fw_util_all">[docs]</a>    <span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">sleep_seconds</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">exponential</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fw_util_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fw-util all --version&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.fw_util_bmc"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.fw_util_bmc">[docs]</a>    <span class="k">def</span> <span class="nf">fw_util_bmc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fw-util bmc --version&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.fw_util_nic"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.fw_util_nic">[docs]</a>    <span class="k">def</span> <span class="nf">fw_util_nic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fw-util nic --version&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.fw_util_bmc_nic_slot"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.fw_util_bmc_nic_slot">[docs]</a>    <span class="k">def</span> <span class="nf">fw_util_bmc_nic_slot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fw_util_bmc</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fw_util_nic</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fw_util</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.get_directory_contents"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_directory_contents">[docs]</a>    <span class="k">def</span> <span class="nf">get_directory_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is used to get the contents of the directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;ls </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dir_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.get_available_space"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_available_space">[docs]</a>    <span class="k">def</span> <span class="nf">get_available_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To get the available memory space on the BMC.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="s2">&quot;df -h | grep </span><span class="se">\&quot;</span><span class="s2">/var/volatile</span><span class="se">\&quot;</span><span class="s2"> | awk &#39;{print$4}&#39;&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span></div>

<div class="viewcode-block" id="OpenBMC.get_total_space"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_total_space">[docs]</a>    <span class="k">def</span> <span class="nf">get_total_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To get the total memory space on the BMC.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="s2">&quot;df -h | grep </span><span class="se">\&quot;</span><span class="s2">/var/volatile</span><span class="se">\&quot;</span><span class="s2"> | awk &#39;{print$2}&#39;&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span></div>

<div class="viewcode-block" id="OpenBMC.fw_update_bios"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.fw_update_bios">[docs]</a>    <span class="k">def</span> <span class="nf">fw_update_bios</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bmc_binary_file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is used to update the bios firmware using OOB(Out Of Band) method.</span>

<span class="sd">        It checks if the file contains the firmware verion&#39;s binary file, else</span>
<span class="sd">        copies the binary file from source location to the destination location.</span>
<span class="sd">        Later, performs the firmware update using the binary file after the</span>
<span class="sd">        power cycle and at the end health of the firmware is checked.</span>

<span class="sd">        Paramaters:</span>
<span class="sd">            bmc_binary_file_path = Binary file path on the destination location</span>
<span class="sd">                                    of the BMC</span>
<span class="sd">        Example:</span>
<span class="sd">            bmc_binary_file_path =</span>
<span class="sd">                &quot;/tmp/havoc_fw_test_&lt;timestamp&gt;/havoc_bios/F08_3A14.bin&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Starting BIOS execution through OpenBMC&quot;</span><span class="p">)</span>
        <span class="c1"># shutdown the server gracefully before flashing the bios thru OOB</span>
        <span class="n">current_reboot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">get_last_reboot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">inband</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
        <span class="c1"># power status after shutdown should show OFF with in few secs</span>
        <span class="n">expected_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">300</span>
        <span class="n">powered_off_status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">expected_time</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">power_status</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;OFF&#39;</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">powered_off_status</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">powered_off_status</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The system din&#39;t go to powered off state&quot;</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fw-util </span><span class="si">%s</span><span class="s2"> --update --bios </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">,</span>
            <span class="n">bmc_binary_file_path</span>
        <span class="p">)</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing OpenBMC </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="c1"># Bios update on Yv2 takes more than 40 minutes</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bios_post_flash</span><span class="p">(</span><span class="n">current_reboot</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.bios_post_flash"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.bios_post_flash">[docs]</a>    <span class="k">def</span> <span class="nf">bios_post_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="OpenBMC.get_openbmc_previous_ver_list"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_openbmc_previous_ver_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_openbmc_previous_ver_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the list of the image versions that have been installed</span>
<span class="sd">        on the BMC using this cat command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;cat /mnt/data/kv_store/image_versions&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.is_hardware_enforce"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.is_hardware_enforce">[docs]</a>    <span class="k">def</span> <span class="nf">is_hardware_enforce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vboot_output</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is used to get the status of the hardware enforce.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            vboot_output = Contains the output of the vboot-util cli.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">vboot_output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Flags hardware_enforce:  0x01&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpenBMC.delete_bmc_destination_path"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.delete_bmc_destination_path">[docs]</a>    <span class="k">def</span> <span class="nf">delete_bmc_destination_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destionation_folder</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;rm -rf </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">destionation_folder</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Removing the destination path on BMC: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.fw_update_cpld"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.fw_update_cpld">[docs]</a>    <span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">sleep_seconds</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">exponential</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fw_update_cpld</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bmc_binary_file_path</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fw-util </span><span class="si">%s</span><span class="s2"> --update --cpld </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">,</span>
            <span class="n">bmc_binary_file_path</span>
        <span class="p">)</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing OpenBMC </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ac_cycle</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.fw_update_bic"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.fw_update_bic">[docs]</a>    <span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">sleep_seconds</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">exponential</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fw_update_bic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bmc_binary_file_path</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fw-util </span><span class="si">%s</span><span class="s2"> --update --bic </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">,</span>
            <span class="n">bmc_binary_file_path</span>
        <span class="p">)</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing OpenBMC </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.fw_update_bicbl"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.fw_update_bicbl">[docs]</a>    <span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">sleep_seconds</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">exponential</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fw_update_bicbl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bmc_binary_file_path</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fw-util </span><span class="si">%s</span><span class="s2"> --update --bicbl </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">,</span>
            <span class="n">bmc_binary_file_path</span>
        <span class="p">)</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing OpenBMC </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.flashcp_kernel"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.flashcp_kernel">[docs]</a>    <span class="k">def</span> <span class="nf">flashcp_kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/sbin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;flashcp -v /tmp/</span><span class="si">%s</span><span class="s2"> /dev/mtd2&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing OpenBMC </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.flashcp_rootfs"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.flashcp_rootfs">[docs]</a>    <span class="k">def</span> <span class="nf">flashcp_rootfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/sbin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;flashcp -v /tmp/</span><span class="si">%s</span><span class="s2"> /dev/mtd3&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing OpenBMC </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.openbmc_flashcp_prerequisite"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.openbmc_flashcp_prerequisite">[docs]</a>    <span class="k">def</span> <span class="nf">openbmc_flashcp_prerequisite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing prerequisite for yosemitev1.0 system&quot;</span><span class="p">)</span>
        <span class="n">pre_requisite</span> <span class="o">=</span> <span class="s2">&quot;fw_setenv bootargs debug console=ttyS0,57600n8 &quot;</span>
        <span class="n">pre_requisite</span> <span class="o">+=</span> <span class="s2">&quot;root=/dev/ram rw mtdparts=spi0.0:-&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">pre_requisite</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reboot</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpenBMC.openbmc_flashcp_upgrade_cmd"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.openbmc_flashcp_upgrade_cmd">[docs]</a>    <span class="k">def</span> <span class="nf">openbmc_flashcp_upgrade_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfile</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/sbin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;flashcp -v /tmp/flash-yosemite /dev/mtd0&quot;</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing OpenBMC </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.openbmc_copyfiles"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.openbmc_copyfiles">[docs]</a>    <span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sleep_seconds</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">openbmc_copyfiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">absolute_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Copying </span><span class="si">%s</span><span class="s2"> file to OpenBMC&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">oob</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">scp_file</span><span class="p">(</span><span class="n">absolute_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.openbmc_flashcp_upgrade"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.openbmc_flashcp_upgrade">[docs]</a>    <span class="k">def</span> <span class="nf">openbmc_flashcp_upgrade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">absolute_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openbmc_flashcp_prerequisite</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openbmc_copyfiles</span><span class="p">(</span><span class="n">absolute_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">openbmc_flashcp_upgrade_cmd</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.sel_clear"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.sel_clear">[docs]</a>    <span class="k">def</span> <span class="nf">sel_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;log-util </span><span class="si">%s</span><span class="s2"> --clear&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="OpenBMC.stop_fan_daemon"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.stop_fan_daemon">[docs]</a>    <span class="k">def</span> <span class="nf">stop_fan_daemon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;ps&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="c1"># First kill fscd runsv, this will relaunch fscd.py</span>
        <span class="n">fscd_runsv</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(\d+).*sv/fscd&quot;</span>
        <span class="n">runsv_id</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">fscd_runsv</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">runsv_id</span><span class="p">:</span>
            <span class="n">proc_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">runsv_id</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;kill -9 </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">proc_id</span><span class="p">)</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing OpenBMC </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get fscd runsv process ID&quot;</span><span class="p">)</span>

        <span class="c1"># Kill fscd.py</span>
        <span class="n">fscd_id</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(\d+).*fscd.py&quot;</span>
        <span class="n">procs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">fscd_id</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">procs</span><span class="p">:</span>
            <span class="n">proc_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">procs</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;kill -9 </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">proc_id</span><span class="p">)</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing OpenBMC </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get fscd process ID&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.start_fan_daemon"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.start_fan_daemon">[docs]</a>    <span class="k">def</span> <span class="nf">start_fan_daemon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/etc/init.d/setup-fan.sh&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;ps&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">fscd_id</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(\d+).*fscd.py&quot;</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">fscd_id</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">proc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to start fscd&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.generate_test_event"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.generate_test_event">[docs]</a>    <span class="k">def</span> <span class="nf">generate_test_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;ipmitool raw &quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;0xA 0x44 0x00 0x00 0x00 0x1 0x2 0x3 0x4 0x5 0x6 &quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;0x4 0x7 0xEB 0x00 0xB 0x00 0x00&quot;</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing Host Command </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

    <span class="c1"># Get config info using cfg-util</span>
<div class="viewcode-block" id="OpenBMC.get_cfg"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_cfg">[docs]</a>    <span class="k">def</span> <span class="nf">get_cfg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;cfg-util dump-all&quot;</span>

        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing OpenBMC </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># Set LED status using fpc-util</span>
<div class="viewcode-block" id="OpenBMC.set_fpc_util"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.set_fpc_util">[docs]</a>    <span class="k">def</span> <span class="nf">set_fpc_util</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identify</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/&quot;</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&quot;fpc-util </span><span class="si">%s</span><span class="s2"> --identify </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_info</span><span class="p">,</span> <span class="n">identify</span><span class="p">)</span>

        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing OpenBMC </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># OpenBMC reboot takes approx 2 mins</span>
<div class="viewcode-block" id="OpenBMC.reboot"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.reboot">[docs]</a>    <span class="k">def</span> <span class="nf">reboot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">filter_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">current_reboot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">get_last_reboot</span><span class="p">()</span>

        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Last reboot time is: [</span><span class="si">%s</span><span class="s2">] &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">current_reboot</span><span class="p">))</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;reboot&quot;</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Rebooting OpenBMC: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_health_check</span><span class="p">(</span><span class="n">current_reboot</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_handler</span><span class="o">.</span><span class="n">add_cmd_metric</span><span class="p">(</span>
            <span class="s2">&quot;reconnect after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_cycle_check</span><span class="p">(</span><span class="n">filter_errors</span><span class="p">)</span></div>

    <span class="c1"># OpenBMC reboot takes approx 2 mins</span>
<div class="viewcode-block" id="OpenBMC.force_reboot"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.force_reboot">[docs]</a>    <span class="k">def</span> <span class="nf">force_reboot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">filter_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">current_reboot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">get_last_reboot</span><span class="p">()</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;reboot -f&quot;</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Rebooting OpenBMC: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Command will not return status</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:No response expected. Trying to reconnect&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_health_check</span><span class="p">(</span><span class="n">current_reboot</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_handler</span><span class="o">.</span><span class="n">add_cmd_metric</span><span class="p">(</span>
            <span class="s2">&quot;reconnect after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.get_critical_services"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_critical_services">[docs]</a>    <span class="k">def</span> <span class="nf">get_critical_services</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a list of services that are always expected to</span>
<span class="sd">        run on the openBMC System</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="OpenBMC.bmc_health_check"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.bmc_health_check">[docs]</a>    <span class="k">def</span> <span class="nf">bmc_health_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_reboot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is to check if all the required daemons like healthd, fscd,</span>
<span class="sd">        sensord are running and started atleast2 mins ago.</span>
<span class="sd">        This check for services if they started 2 mins ago is to makesure the</span>
<span class="sd">        daemons have started and collected the required information atleast one</span>
<span class="sd">        time and out havoc tests doesnt fails sensord non-reporting errors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">last_reboot</span><span class="p">:</span>
            <span class="c1"># Reboot, sometimes, is failing to connect even after waiting for 240</span>
            <span class="c1"># second so increased to 300 seconds.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">wait_for_reconnect</span><span class="p">(</span><span class="n">last_reboot</span><span class="p">,</span> <span class="mi">1200</span><span class="p">)</span>
        <span class="c1"># Get the critical services that has to be running on each platform</span>
        <span class="n">bmc_daemons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_critical_services</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">each_daemon</span> <span class="ow">in</span> <span class="n">bmc_daemons</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_daemon_run_time</span><span class="p">(</span><span class="n">each_daemon</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.check_daemon_run_time"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.check_daemon_run_time">[docs]</a>    <span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">sleep_seconds</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">check_daemon_run_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">daemon</span><span class="p">,</span> <span class="n">runtime_expected</span><span class="p">):</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;sv status </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">daemon</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;down&quot;</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;Service </span><span class="si">%s</span><span class="s2"> is not running&quot;</span> <span class="o">%</span> <span class="n">daemon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;.*\s+(\d+)s&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
            <span class="n">runtime</span> <span class="o">=</span> <span class="n">time_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">runtime_expected</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">runtime_expected</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">runtime</span><span class="p">))</span></div>

    <span class="c1"># Check OpenBMC &#39;ps&#39; make sure important process is running</span>
<div class="viewcode-block" id="OpenBMC.check_ps"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.check_ps">[docs]</a>    <span class="k">def</span> <span class="nf">check_ps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;ps&quot;</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Executing OpenBMC </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;dhclient -6&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;IPV6 dhclient NOT running&quot;</span><span class="p">)</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;fscd&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;fscd NOT running&quot;</span><span class="p">)</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;ipmid&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ipmid NOT running&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;sys_utils&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ipmi</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="OpenBMC.validate_vboot_util"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.validate_vboot_util">[docs]</a>    <span class="k">def</span> <span class="nf">validate_vboot_util</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">err_val</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vboot_util</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Status type \(\d+\) code \(\d+\)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">err_code</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\b\d+\b&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)]</span>
                <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Error Codes: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">codes</span> <span class="ow">in</span> <span class="n">err_code</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">codes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">err_val</span> <span class="o">=</span> <span class="n">err_val</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">filter_errors</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;vboot_failure_code&quot;</span> <span class="ow">in</span> <span class="n">filter_errors</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">err_code</span> <span class="o">==</span> <span class="n">filter_errors</span><span class="p">[</span><span class="s2">&quot;vboot_failure_code&quot;</span><span class="p">]:</span>
                    <span class="n">err_val</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">err_val</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;vboot-util is validated for success criteria&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Vboot validation not successful with error code </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err_code</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.post_cycle_check"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.post_cycle_check">[docs]</a>    <span class="k">def</span> <span class="nf">post_cycle_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="OpenBMC.get_bmcreset_cmd"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_bmcreset_cmd">[docs]</a>    <span class="k">def</span> <span class="nf">get_bmcreset_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;yosemite_bmcreset_force&quot;</span>
        <span class="k">return</span> <span class="n">cmd</span></div>

<div class="viewcode-block" id="OpenBMC.forced_bmc_reset"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.forced_bmc_reset">[docs]</a>    <span class="k">def</span> <span class="nf">forced_bmc_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">current_reboot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">get_last_reboot</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bmcreset_cmd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>  <span class="c1"># noqa</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Openbmc forced reset: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;BMC forced reset FAILED&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_health_check</span><span class="p">(</span><span class="n">current_reboot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_cycle_check</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpenBMC.get_usb0_ip"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_usb0_ip">[docs]</a>    <span class="k">def</span> <span class="nf">get_usb0_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;ifconfig&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;usb0&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_usb0_interface</span><span class="p">()</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;ifconfig usb0&quot;</span><span class="p">)</span>
        <span class="n">result1</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">match_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result1</span><span class="p">)):</span>
            <span class="k">if</span> <span class="s2">&quot;usb0&quot;</span> <span class="ow">in</span> <span class="n">result1</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">match_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">match_line</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">req_line</span> <span class="o">=</span> <span class="n">result1</span><span class="p">[</span><span class="n">match_line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match_found</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No usb0 device detected&quot;</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\w*)::(\w*):(\w*):&quot;</span><span class="p">,</span> <span class="n">req_line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">usb_ip</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">usb_ip</span> <span class="o">+</span> <span class="s2">&quot;1</span><span class="si">%u</span><span class="s2">sb0&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not able to get ipv6 address for usb0, please check&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">host</span></div>

<div class="viewcode-block" id="OpenBMC.check_hardware_enforcement"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.check_hardware_enforcement">[docs]</a>    <span class="k">def</span> <span class="nf">check_hardware_enforcement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vboot_util</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Flags hardware_enforce: &quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">hardware_enforce</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">hardware_enforce</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;0x01&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpenBMC.ast_alternate_boot_source"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.ast_alternate_boot_source">[docs]</a>    <span class="k">def</span> <span class="nf">ast_alternate_boot_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configures wdt2 to enable alternate boot source feature and triggers it</span>
<span class="sd">        1. This will force the bmc to reboot</span>
<span class="sd">        2. Use SPI1 as the primary boot instead of SPI0</span>
<span class="sd">        This is a potential workaround to verified boot</span>
<span class="sd">        (Since for vboot we boot from SPI0 and verify SPI1.</span>
<span class="sd">        If someone fools the chip into booting from SPI1 directly,</span>
<span class="sd">        they can easily flash whatever they want on SPI1 and then trigger this).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_reboot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">get_last_reboot</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/sbin/devmem 0x1e785024 32 0x1 &amp;&amp; /sbin/devmem 0x1e78502c 32 0xb3 &amp;&amp; /sbin/devmem 0x1e78502 32 0x4755&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_health_check</span><span class="p">(</span><span class="n">current_reboot</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/sbin/devmem  0x1E785020&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="c1"># bit 1 (second LSB) should be 0, from the hexadecimal output</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;ROM resumes execution from SPI0.0&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ROM failed to execute from SPI0.0&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenBMC.graceful_shutdown"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.graceful_shutdown">[docs]</a>    <span class="k">def</span> <span class="nf">graceful_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">):</span>
        <span class="n">boot_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_command</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">boot_cmd</span><span class="p">[</span><span class="s2">&quot;graceful-shutdown&quot;</span><span class="p">]</span>
        <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Graceful-shutdown: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_host</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_powered_on</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to shut down the server&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">AutovalUtils</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Graceful shutdown complete&quot;</span><span class="p">)</span></div>

    <span class="c1"># TODO need to identify command to get flash temperature</span>
<div class="viewcode-block" id="OpenBMC.get_flash_temperature"><a class="viewcode-back" href="../../../../../havoc.autoval.lib.host.html#havoc.autoval.lib.host.openbmc.OpenBMC.get_flash_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">get_flash_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;Flash Temperature Not Supported&quot;</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Copyright (c) 2016-present, Facebook, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>